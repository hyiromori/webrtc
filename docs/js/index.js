(()=>{"use strict";var e={348:(e,n,t)=>{var o,r,i,a,c,l,s,u,f,d,p=t(294),h=t(935),m=t(586),b=t(163),g=new function(){var e=this;this.connectionId=null,this.listener=null,this.webSocket=null,this.setListener=function(n){e.listener=n},this.close=function(){if(null!=e.webSocket)return e.webSocket.close(),e.webSocket=null,void console.info("[WS] WebSocket closed.");console.debug("[WS] WebSocket already closed.")},this.getId=function(){return e.connectionId},this.getState=function(){if(null!=e.webSocket)switch(e.webSocket.readyState){case 0:return"Connecting";case 1:return null==e.connectionId?"Open":"Ready";case 2:return"Closing";case 3:return"Closed"}return"Disconnected"},this.reconnect=function(){null!=e.webSocket&&e.close(),e.webSocket=new WebSocket("wss://websocket.hyiromori.com/"),e.webSocket.onmessage=function(n){return e.onMessage(n)},e.webSocket.onopen=function(n){console.info("[WS] WebSocket open:",n),e.send({type:"info"})},e.webSocket.onerror=function(n){console.error("[WS] WebSocket error:",n),e.close()},e.webSocket.onclose=function(n){console.error("[WS] WebSocket closed:",n),e.close()}},this.send=function(n){null!=e.webSocket?(console.debug("[WS] Send message:",JSON.stringify(n)),e.webSocket.send(JSON.stringify(n))):console.error("[WS] Cannot send message because WebSocket is closed.")},this.onMessage=function(n){var t;console.debug("[WS] Receive message:",n.data);var o=JSON.parse(n.data);switch(o.type){case"info":e.connectionId=o.data.connectionId,console.info("[WS] WebSocket Connection ID:",e.connectionId);break;case"unicast":case"joined":case"leaved":null!=e.listener&&e.listener(o);break;case"broadcast":null!=e.listener&&(null===(t=o.payload)||void 0===t?void 0:t.from)!==e.connectionId&&e.listener(o);break;default:console.error("[WS] Unknown response:",o)}},this.reconnect()},v=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function c(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}l((o=o.apply(e,n||[])).next())}))},y=function(e,n){var t,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(e,a)}catch(e){i=[6,e],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},w={sdpSemantics:"unified-plan",iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]},S=function(e){null!=e&&(e.getVideoTracks().forEach((function(e){return e.stop()})),e.getAudioTracks().forEach((function(e){return e.stop()})))},x=function(e,n){var t=this;this.localStream=null,this.peers={},this.sendSignalingMessage=function(e,n){g.send({type:"unicast",to:e,payload:n})},this.start=function(){return v(t,void 0,void 0,(function(){var e;return y(this,(function(n){switch(n.label){case 0:return[4,navigator.mediaDevices.getUserMedia({audio:!0,video:!0})];case 1:return e=n.sent(),this.localStream=e,g.send({type:"join",to:this.room}),[2,e]}}))}))},this.stop=function(){S(t.localStream),Object.keys(t.peers).forEach((function(e){return t.leavePeer(e)})),g.send({type:"broadcast",to:t.room,payload:{type:"leave",from:g.getId()}}),g.send({type:"leave",from:t.room})},this.receiveSignalingMessage=function(e){return v(t,void 0,void 0,(function(){var n,t,o,r,i;return y(this,(function(a){switch(a.label){case 0:switch(n=e.from,t=this.getPeerInfo(n).connection,e.type){case"sdp":return[3,1];case"candidate":return[3,6]}return[3,8];case 1:return[4,t.setRemoteDescription(new RTCSessionDescription(e.sdp))];case 2:return a.sent(),o=g.getId(),"offer"!==(null===(i=null==t?void 0:t.remoteDescription)||void 0===i?void 0:i.type)||null==o?[3,5]:[4,t.createAnswer()];case 3:return r=a.sent(),[4,t.setLocalDescription(r)];case 4:a.sent(),this.sendSignalingMessage(n,{from:o,type:"sdp",sdp:r}),a.label=5;case 5:return[3,8];case 6:return[4,t.addIceCandidate(new RTCIceCandidate(e.candidate))];case 7:return a.sent(),[3,8];case 8:return[2]}}))}))},this.remoteStreams=function(){return Object.values(t.peers).map((function(e){return e.stream})).filter((function(e){return null!=e}))},this.leavePeer=function(e){var n=t.peers[e];if(null!=n){var o=n.connection,r=n.stream;delete t.peers[e],o.close(),S(r),t.onChangeRemoteStreams(t.remoteStreams())}},this.getPeerInfo=function(e,n){if(void 0===n&&(n=!1),null==t.peers[e]){var o=new RTCPeerConnection(w);o.ontrack=function(n){n.streams.forEach((function(n){return t.getPeerInfo(e).stream=n})),t.onChangeRemoteStreams(t.remoteStreams())},o.onicecandidate=function(n){var o=g.getId();null!=n.candidate&&null!=o&&t.sendSignalingMessage(e,{type:"candidate",candidate:n.candidate,from:o})},o.onnegotiationneeded=function(){var r=g.getId();n&&null!=r&&o.createOffer().then((function(n){o.setLocalDescription(n),t.sendSignalingMessage(e,{type:"sdp",sdp:n,from:r})}))},null!=t.localStream&&o.addTrack(t.localStream.getVideoTracks()[0],t.localStream),t.peers[e]={connection:o}}return t.peers[e]},this.enableSelfCamera=function(e){return null!=t.localStream&&(t.localStream.getVideoTracks().forEach((function(n){return n.enabled=e})),!0)},this.enableSelfMic=function(e){return null!=t.localStream&&(t.localStream.getAudioTracks().forEach((function(n){return n.enabled=e})),!0)},this.room=e,this.onChangeRemoteStreams=n,g.setListener((function(e){return v(t,void 0,void 0,(function(){var n,t,o,r;return y(this,(function(i){switch(i.label){case 0:switch(e.type){case"joined":return[3,1];case"broadcast":return[3,2];case"unicast":return[3,3]}return[3,5];case 1:return g.send({type:"broadcast",to:this.room,payload:{type:"join",from:g.getId()}}),[3,6];case 2:return"join"===(null===(o=null==e?void 0:e.payload)||void 0===o?void 0:o.type)?(n=e.payload.from,this.getPeerInfo(n,!0)):"leave"===(null===(r=null==e?void 0:e.payload)||void 0===r?void 0:r.type)&&(n=e.payload.from,this.leavePeer(n)),[3,6];case 3:return t=e.payload,[4,this.receiveSignalingMessage(t)];case 4:return i.sent(),[3,6];case 5:console.debug("[WebRTC] Through message:",e),i.label=6;case 6:return[2]}}))}))}))},k=b.ZP.video(o||(f=["\n  height: 100%;\n  max-height: 100%;\n  max-width: 100%;\n  object-fit: contain;\n  width: 100%;\n"],d=["\n  height: 100%;\n  max-height: 100%;\n  max-width: 100%;\n  object-fit: contain;\n  width: 100%;\n"],Object.defineProperty?Object.defineProperty(f,"raw",{value:d}):f.raw=d,o=f)),E=function(e){var n=e.srcObject,t=e.muted,o=(0,p.useState)(null),r=o[0],i=o[1];return(0,p.useEffect)((function(){null!=r&&(r.srcObject=n)}),[n,r]),p.createElement(k,{ref:i,autoPlay:!0,playsInline:!0,muted:t||!1})},j=function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},P=b.ZP.div(r||(r=j(["\n  bottom: 0;\n  display: flex;\n  left: 0;\n  position: absolute;\n  right: 0;\n  top: 0;\n"],["\n  bottom: 0;\n  display: flex;\n  left: 0;\n  position: absolute;\n  right: 0;\n  top: 0;\n"]))),I=b.ZP.div(i||(i=j(["\n  align-items: center;\n  display: flex;\n  flex: 1;\n  justify-content: center;\n  min-height: 50%;\n  min-width: 50%;\n"],["\n  align-items: center;\n  display: flex;\n  flex: 1;\n  justify-content: center;\n  min-height: 50%;\n  min-width: 50%;\n"]))),C=b.ZP.div(a||(a=j(["\n  align-items: flex-end;\n  bottom: 0;\n  display: flex;\n  justify-content: flex-end;\n  max-height: 10vh;\n  max-width: 10vw;\n  position: absolute;\n  right: 0;\n"],["\n  align-items: flex-end;\n  bottom: 0;\n  display: flex;\n  justify-content: flex-end;\n  max-height: 10vh;\n  max-width: 10vw;\n  position: absolute;\n  right: 0;\n"]))),O=function(e){var n=e.self,t=e.peers;switch(e.type){case"basic":return p.createElement(P,null,t.map((function(e){return p.createElement(I,{key:e.id},p.createElement(E,{srcObject:e}))})),p.createElement(C,null,p.createElement(E,{srcObject:n,muted:!0})));default:return null}},W=function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},T=b.ZP.div(c||(c=W(["\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n"],["\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n"]))),R=b.ZP.header(l||(l=W(["\n  align-items: center;\n  border-bottom: 1px solid silver;\n  display: flex;\n  height: 3rem;\n  justify-content: center;\n  left: 0;\n  position: fixed;\n  right: 0;\n  text-align: center;\n  top: 0;\n"],["\n  align-items: center;\n  border-bottom: 1px solid silver;\n  display: flex;\n  height: 3rem;\n  justify-content: center;\n  left: 0;\n  position: fixed;\n  right: 0;\n  text-align: center;\n  top: 0;\n"]))),M=b.ZP.input(s||(s=W(["\n  border: solid silver;\n  border-width: 0 0 1px 0; \n  font-size: 1rem;\n  text-align: center;\n  width: 24rem;\n  padding: 0.25rem;\n"],["\n  border: solid silver;\n  border-width: 0 0 1px 0; \n  font-size: 1rem;\n  text-align: center;\n  width: 24rem;\n  padding: 0.25rem;\n"]))),Z=b.ZP.main(u||(u=W(["\n  left: 0;\n  top: 3rem;\n  position: fixed;\n  right: 0;\n  bottom: 0;\n"],["\n  left: 0;\n  top: 3rem;\n  position: fixed;\n  right: 0;\n  bottom: 0;\n"]))),D=null;h.render(p.createElement((function(){var e=(0,p.useState)(""),n=e[0],t=e[1],o=(0,p.useState)(null),r=o[0],i=o[1],a=(0,p.useState)([]),c=a[0],l=a[1],s=function(e){t(e),localStorage.setItem("webrtc:room",e)};return(0,p.useEffect)((function(){var e=function(e){if(""===e)return{};var n={};return e.substr(1).split("&").forEach((function(e){var t=e.split("=",2),o=t[0],r=t[1];n[o]=decodeURIComponent(r)})),n}(location.search).room;e?s(e):t(localStorage.getItem("webrtc:room")||(0,m.Z)())}),[]),(0,p.useEffect)((function(){window.addEventListener("beforeunload",(function(e){null!=D&&D.stop()}))}),[]),(0,p.useEffect)((function(){window.history.replaceState(null,n,"./?room="+n)}),[n]),p.createElement(T,null,p.createElement(R,null,"Room:",p.createElement(M,{type:"text",value:n,onChange:function(e){return s(e.target.value)}}),p.createElement("button",{onClick:function(){return e=void 0,t=void 0,r=function(){var e;return function(e,n){var t,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(e,a)}catch(e){i=[6,e],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(t){switch(t.label){case 0:return null!=D&&(D.stop(),D=null),[4,(D=new x(n,l)).start()];case 1:return e=t.sent(),i(e),[2]}}))},new((o=void 0)||(o=Promise))((function(n,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function c(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,c)}l((r=r.apply(e,t||[])).next())}));var e,t,o,r}},"接続"),p.createElement("button",{onClick:function(){null!=D&&D.stop(),D=null,i(null)}},"切断")),p.createElement(Z,null,p.createElement(O,{self:r,peers:c,type:"basic"})))}),null),document.getElementById("app"))}},n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{}};return e[o](r,r.exports,t),r.exports}t.m=e,t.x=e=>{},t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),(()=>{var e={826:0},n=[[348,592]],o=e=>{},r=(r,i)=>{for(var a,c,[l,s,u,f]=i,d=0,p=[];d<l.length;d++)c=l[d],t.o(e,c)&&e[c]&&p.push(e[c][0]),e[c]=0;for(a in s)t.o(s,a)&&(t.m[a]=s[a]);for(u&&u(t),r&&r(i);p.length;)p.shift()();return f&&n.push.apply(n,f),o()},i=self.webpackChunkwebrtc=self.webpackChunkwebrtc||[];function a(){for(var o,r=0;r<n.length;r++){for(var i=n[r],a=!0,c=1;c<i.length;c++){var l=i[c];0!==e[l]&&(a=!1)}a&&(n.splice(r--,1),o=t(t.s=i[0]))}return 0===n.length&&(t.x(),t.x=e=>{}),o}i.forEach(r.bind(null,0)),i.push=r.bind(null,i.push.bind(i));var c=t.x;t.x=()=>(t.x=c||(e=>{}),(o=a)())})(),t.x()})();