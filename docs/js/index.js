(()=>{"use strict";var e={35:(e,n,t)=>{var r,o,i,a,l,c,s,u,d,f,p,h=t(294),m=t(935),b=t(163),g=new function(){var e=this;this.connectionId=null,this.listener=null,this.webSocket=null,this.setListener=function(n){e.listener=n},this.close=function(){if(null!=e.webSocket)return e.webSocket.close(),e.webSocket=null,void console.info("[WS] WebSocket closed.");console.debug("[WS] WebSocket already closed.")},this.getId=function(){return e.connectionId},this.getState=function(){if(null!=e.webSocket)switch(e.webSocket.readyState){case 0:return"Connecting";case 1:return null==e.connectionId?"Open":"Ready";case 2:return"Closing";case 3:return"Closed"}return"Disconnected"},this.reconnect=function(){null!=e.webSocket&&e.close(),e.webSocket=new WebSocket("wss://websocket.hyiromori.com/"),e.webSocket.onmessage=function(n){return e.onMessage(n)},e.webSocket.onopen=function(n){console.info("[WS] WebSocket open:",n),e.send({type:"info"})},e.webSocket.onerror=function(n){console.error("[WS] WebSocket error:",n),e.close()},e.webSocket.onclose=function(n){console.error("[WS] WebSocket closed:",n),e.close()}},this.send=function(n){null!=e.webSocket?(console.debug("[WS] Send message:",JSON.stringify(n)),e.webSocket.send(JSON.stringify(n))):console.error("[WS] Cannot send message because WebSocket is closed.")},this.onMessage=function(n){var t;console.debug("[WS] Receive message:",n.data);var r=JSON.parse(n.data);switch(r.type){case"info":e.connectionId=r.data.connectionId,console.info("[WS] WebSocket Connection ID:",e.connectionId);break;case"unicast":case"joined":case"leaved":null!=e.listener&&e.listener(r);break;case"broadcast":null!=e.listener&&(null===(t=r.payload)||void 0===t?void 0:t.from)!==e.connectionId&&e.listener(r);break;default:console.error("[WS] Unknown response:",r)}},this.reconnect()},v=function(e,n,t,r){return new(t||(t=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function l(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,l)}c((r=r.apply(e,n||[])).next())}))},y=function(e,n){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(e,a)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},w={sdpSemantics:"unified-plan",iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]},S=function(e){null!=e&&(e.getVideoTracks().forEach((function(e){return e.stop()})),e.getAudioTracks().forEach((function(e){return e.stop()})))},x=function(e,n){var t=this;this.localStream=null,this.peers={},this.sendSignalingMessage=function(e,n){g.send({type:"unicast",to:e,payload:n})},this.start=function(){return v(t,void 0,void 0,(function(){var e;return y(this,(function(n){switch(n.label){case 0:return[4,navigator.mediaDevices.getUserMedia({audio:!0,video:!0})];case 1:return e=n.sent(),this.localStream=e,g.send({type:"join",to:this.room}),[2,e]}}))}))},this.stop=function(){S(t.localStream),Object.keys(t.peers).forEach((function(e){return t.leavePeer(e)})),g.send({type:"broadcast",to:t.room,payload:{type:"leave",from:g.getId()}}),g.send({type:"leave",from:t.room})},this.receiveSignalingMessage=function(e){return v(t,void 0,void 0,(function(){var n,t,r,o,i;return y(this,(function(a){switch(a.label){case 0:switch(n=e.from,t=this.getPeerInfo(n).connection,e.type){case"sdp":return[3,1];case"candidate":return[3,6]}return[3,8];case 1:return[4,t.setRemoteDescription(new RTCSessionDescription(e.sdp))];case 2:return a.sent(),r=g.getId(),"offer"!==(null===(i=null==t?void 0:t.remoteDescription)||void 0===i?void 0:i.type)||null==r?[3,5]:[4,t.createAnswer()];case 3:return o=a.sent(),[4,t.setLocalDescription(o)];case 4:a.sent(),this.sendSignalingMessage(n,{from:r,type:"sdp",sdp:o}),a.label=5;case 5:return[3,8];case 6:return[4,t.addIceCandidate(new RTCIceCandidate(e.candidate))];case 7:return a.sent(),[3,8];case 8:return[2]}}))}))},this.remoteStreams=function(){return Object.values(t.peers).map((function(e){return e.stream})).filter((function(e){return null!=e}))},this.leavePeer=function(e){var n=t.peers[e];if(null!=n){var r=n.connection,o=n.stream;delete t.peers[e],r.close(),S(o),t.onChangeRemoteStreams(t.remoteStreams())}},this.getPeerInfo=function(e,n){if(void 0===n&&(n=!1),null==t.peers[e]){var r=new RTCPeerConnection(w);r.ontrack=function(n){n.streams.forEach((function(n){return t.getPeerInfo(e).stream=n})),t.onChangeRemoteStreams(t.remoteStreams())},r.onicecandidate=function(n){var r=g.getId();null!=n.candidate&&null!=r&&t.sendSignalingMessage(e,{type:"candidate",candidate:n.candidate,from:r})},r.onnegotiationneeded=function(){var o=g.getId();n&&null!=o&&r.createOffer().then((function(n){r.setLocalDescription(n),t.sendSignalingMessage(e,{type:"sdp",sdp:n,from:o})}))},null!=t.localStream&&r.addTrack(t.localStream.getVideoTracks()[0],t.localStream),t.peers[e]={connection:r}}return t.peers[e]},this.enableSelfCamera=function(e){return null!=t.localStream&&(t.localStream.getVideoTracks().forEach((function(n){return n.enabled=e})),!0)},this.enableSelfMic=function(e){return null!=t.localStream&&(t.localStream.getAudioTracks().forEach((function(n){return n.enabled=e})),!0)},this.room=e,this.onChangeRemoteStreams=n,g.setListener((function(e){return v(t,void 0,void 0,(function(){var n,t,r,o;return y(this,(function(i){switch(i.label){case 0:switch(e.type){case"joined":return[3,1];case"broadcast":return[3,2];case"unicast":return[3,3]}return[3,5];case 1:return g.send({type:"broadcast",to:this.room,payload:{type:"join",from:g.getId()}}),[3,6];case 2:return"join"===(null===(r=null==e?void 0:e.payload)||void 0===r?void 0:r.type)?(n=e.payload.from,this.getPeerInfo(n,!0)):"leave"===(null===(o=null==e?void 0:e.payload)||void 0===o?void 0:o.type)&&(n=e.payload.from,this.leavePeer(n)),[3,6];case 3:return t=e.payload,[4,this.receiveSignalingMessage(t)];case 4:return i.sent(),[3,6];case 5:console.debug("[WebRTC] Through message:",e),i.label=6;case 6:return[2]}}))}))}))},k=b.ZP.video(r||(f=["\n  height: 100%;\n  max-height: 100%;\n  max-width: 100%;\n  object-fit: contain;\n  width: 100%;\n"],p=["\n  height: 100%;\n  max-height: 100%;\n  max-width: 100%;\n  object-fit: contain;\n  width: 100%;\n"],Object.defineProperty?Object.defineProperty(f,"raw",{value:p}):f.raw=p,r=f)),E=function(e){var n=e.srcObject,t=e.muted,r=(0,h.useState)(null),o=r[0],i=r[1];return(0,h.useEffect)((function(){null!=o&&(o.srcObject=n)}),[n,o]),h.createElement(k,{ref:i,autoPlay:!0,playsInline:!0,muted:t||!1})},j=function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},P=b.ZP.div(o||(o=j(["\n  bottom: 0;\n  display: flex;\n  left: 0;\n  position: absolute;\n  right: 0;\n  top: 0;\n"],["\n  bottom: 0;\n  display: flex;\n  left: 0;\n  position: absolute;\n  right: 0;\n  top: 0;\n"]))),I=b.ZP.div(i||(i=j(["\n  align-items: center;\n  display: flex;\n  flex: 1;\n  justify-content: center;\n  min-height: 50%;\n  min-width: 50%;\n"],["\n  align-items: center;\n  display: flex;\n  flex: 1;\n  justify-content: center;\n  min-height: 50%;\n  min-width: 50%;\n"]))),C=b.ZP.div(a||(a=j(["\n  align-items: flex-end;\n  bottom: 0;\n  display: flex;\n  justify-content: flex-end;\n  max-height: 10vh;\n  max-width: 10vw;\n  position: absolute;\n  right: 0;\n"],["\n  align-items: flex-end;\n  bottom: 0;\n  display: flex;\n  justify-content: flex-end;\n  max-height: 10vh;\n  max-width: 10vw;\n  position: absolute;\n  right: 0;\n"]))),O=function(e){var n=e.self,t=e.peers;switch(e.type){case"basic":return h.createElement(P,null,t.map((function(e){return h.createElement(I,{key:e.id},h.createElement(E,{srcObject:e}))})),h.createElement(C,null,h.createElement(E,{srcObject:n,muted:!0})));default:return null}},W="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890",M=function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},T=b.ZP.div(l||(l=M(["\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n"],["\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n"]))),R=b.ZP.header(c||(c=M(["\n  align-items: center;\n  border-bottom: 1px solid silver;\n  display: flex;\n  height: 3rem;\n  justify-content: center;\n  left: 0;\n  position: fixed;\n  right: 0;\n  text-align: center;\n  top: 0;\n"],["\n  align-items: center;\n  border-bottom: 1px solid silver;\n  display: flex;\n  height: 3rem;\n  justify-content: center;\n  left: 0;\n  position: fixed;\n  right: 0;\n  text-align: center;\n  top: 0;\n"]))),Z=b.ZP.input(s||(s=M(["\n  border: solid silver;\n  border-width: 0 0 1px 0; \n  font-size: 1rem;\n  text-align: center;\n  width: 8rem;\n  padding: 0.25rem;\n"],["\n  border: solid silver;\n  border-width: 0 0 1px 0; \n  font-size: 1rem;\n  text-align: center;\n  width: 8rem;\n  padding: 0.25rem;\n"]))),D=b.ZP.button(u||(u=M(["\n  margin-left: 0.25rem;\n  padding: 0.25rem;\n"],["\n  margin-left: 0.25rem;\n  padding: 0.25rem;\n"]))),A=b.ZP.main(d||(d=M(["\n  left: 0;\n  top: 3rem;\n  position: fixed;\n  right: 0;\n  bottom: 0;\n"],["\n  left: 0;\n  top: 3rem;\n  position: fixed;\n  right: 0;\n  bottom: 0;\n"]))),L=null;m.render(h.createElement((function(){var e=(0,h.useState)(""),n=e[0],t=e[1],r=(0,h.useState)(null),o=r[0],i=r[1],a=(0,h.useState)([]),l=a[0],c=a[1],s=null!=L,u=function(e){t(e),localStorage.setItem("webrtc:room",e)};return(0,h.useEffect)((function(){var e=function(e){if(""===e)return{};var n={};return e.substr(1).split("&").forEach((function(e){var t=e.split("=",2),r=t[0],o=t[1];n[r]=decodeURIComponent(o)})),n}(location.search).room;e?u(e):t(localStorage.getItem("webrtc:room")||(12,Array.from({length:12}).map((function(){return W.charAt(Math.floor(Math.random()*W.length))})).join("")))}),[]),(0,h.useEffect)((function(){window.addEventListener("beforeunload",(function(){null!=L&&L.stop()}))}),[]),(0,h.useEffect)((function(){window.history.replaceState(null,n,"./?room="+n)}),[n]),h.createElement(T,null,h.createElement(R,null,"Room:",h.createElement(Z,{disabled:s,onChange:function(e){return u(e.target.value)},type:"text",value:n}),h.createElement(D,{onClick:function(){return e=void 0,t=void 0,o=function(){var e;return function(e,n){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(e,a)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(t){switch(t.label){case 0:return null!=L&&(L.stop(),L=null),[4,(L=new x(n,c)).start()];case 1:return e=t.sent(),i(e),[2]}}))},new((r=void 0)||(r=Promise))((function(n,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function l(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,l)}c((o=o.apply(e,t||[])).next())}));var e,t,r,o},disabled:s},"Start"),h.createElement(D,{onClick:function(){null!=L&&L.stop(),L=null,i(null)},disabled:!s},"End")),h.createElement(A,null,h.createElement(O,{self:o,peers:l,type:"basic"})))}),null),document.getElementById("app"))}},n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{}};return e[r](o,o.exports,t),o.exports}t.m=e,t.x=e=>{},t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),(()=>{var e={826:0},n=[[35,592]],r=e=>{},o=(o,i)=>{for(var a,l,[c,s,u,d]=i,f=0,p=[];f<c.length;f++)l=c[f],t.o(e,l)&&e[l]&&p.push(e[l][0]),e[l]=0;for(a in s)t.o(s,a)&&(t.m[a]=s[a]);for(u&&u(t),o&&o(i);p.length;)p.shift()();return d&&n.push.apply(n,d),r()},i=self.webpackChunkwebrtc=self.webpackChunkwebrtc||[];function a(){for(var r,o=0;o<n.length;o++){for(var i=n[o],a=!0,l=1;l<i.length;l++){var c=i[l];0!==e[c]&&(a=!1)}a&&(n.splice(o--,1),r=t(t.s=i[0]))}return 0===n.length&&(t.x(),t.x=e=>{}),r}i.forEach(o.bind(null,0)),i.push=o.bind(null,i.push.bind(i));var l=t.x;t.x=()=>(t.x=l||(e=>{}),(r=a)())})(),t.x()})();